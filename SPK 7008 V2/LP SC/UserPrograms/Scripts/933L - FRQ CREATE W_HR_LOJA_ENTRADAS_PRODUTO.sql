IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[W_HR_LOJA_ENTRADAS_PRODUTO]'))
EXEC dbo.sp_executesql @statement = N'
     
CREATE VIEW [dbo].[W_HR_LOJA_ENTRADAS_PRODUTO] AS    
SELECT     
CHAVE_NFE,    
FILIAL  AS FILIAL,    
NF_NUMERO AS NUMERO_NF_TRANSFERENCIA,     
SERIE_NF AS SERIE_NF_ENTRADA,     
NF_NUMERO AS ROMANEIO_PRODUTO,     
FORNECEDOR,     
PRODUTO,     
COR_PRODUTO,    
''55'' AS ESPECIE_SERIE,    
 1 AS ENTRADA_CONFERIDA ,    
 1 AS ENTRADA_ENCERRADA ,     
 0 AS ENTRADA_CANCELADA ,    
CONVERT(INT,SUM(QTDE)) AS QTDE_ENTRADA,     
 CONVERT(NUMERIC(14,2),MAX(PRECO)) AS PRECO,   
 ARQUIVO,     
 EMISSAO as data_saida,   
 SUM(CASE WHEN TAMANHO=1  THEN QTDE ELSE 0 END) AS EN1,        
 SUM(CASE WHEN TAMANHO=2  THEN QTDE ELSE 0 END) AS EN2,        
 SUM(CASE WHEN TAMANHO=3  THEN QTDE ELSE 0 END) AS EN3,        
 SUM(CASE WHEN TAMANHO=4  THEN QTDE ELSE 0 END) AS EN4,        
 SUM(CASE WHEN TAMANHO=5  THEN QTDE ELSE 0 END) AS EN5,        
 SUM(CASE WHEN TAMANHO=6  THEN QTDE ELSE 0 END) AS EN6,        
 SUM(CASE WHEN TAMANHO=7  THEN QTDE ELSE 0 END) AS EN7,                  
 SUM(CASE WHEN TAMANHO=8  THEN QTDE ELSE 0 END) AS EN8,        
 SUM(CASE WHEN TAMANHO=9  THEN QTDE ELSE 0 END) AS EN9,        
 SUM(CASE WHEN TAMANHO=10 THEN QTDE ELSE 0 END) AS EN10,        
 SUM(CASE WHEN TAMANHO=11 THEN QTDE ELSE 0 END) AS EN11,        
 SUM(CASE WHEN TAMANHO=12 THEN QTDE ELSE 0 END) AS EN12,        
 SUM(CASE WHEN TAMANHO=13 THEN QTDE ELSE 0 END) AS EN13,        
 SUM(CASE WHEN TAMANHO=14 THEN QTDE ELSE 0 END) AS EN14,        
 SUM(CASE WHEN TAMANHO=15 THEN QTDE ELSE 0 END) AS EN15,        
 SUM(CASE WHEN TAMANHO=16 THEN QTDE ELSE 0 END) AS EN16,        
 SUM(CASE WHEN TAMANHO=17 THEN QTDE ELSE 0 END) AS EN17,        
 SUM(CASE WHEN TAMANHO=18 THEN QTDE ELSE 0 END) AS EN18,        
 SUM(CASE WHEN TAMANHO=19 THEN QTDE ELSE 0 END) AS EN19,        
 SUM(CASE WHEN TAMANHO=20 THEN QTDE ELSE 0 END) AS EN20,        
 SUM(CASE WHEN TAMANHO=21 THEN QTDE ELSE 0 END) AS EN21,        
 SUM(CASE WHEN TAMANHO=22 THEN QTDE ELSE 0 END) AS EN22,        
 SUM(CASE WHEN TAMANHO=23 THEN QTDE ELSE 0 END) AS EN23,        
 SUM(CASE WHEN TAMANHO=24 THEN QTDE ELSE 0 END) AS EN24,        
 SUM(CASE WHEN TAMANHO=25 THEN QTDE ELSE 0 END) AS EN25,        
 SUM(CASE WHEN TAMANHO=26 THEN QTDE ELSE 0 END) AS EN26,        
 SUM(CASE WHEN TAMANHO=27 THEN QTDE ELSE 0 END) AS EN27,        
 SUM(CASE WHEN TAMANHO=28 THEN QTDE ELSE 0 END) AS EN28,        
 SUM(CASE WHEN TAMANHO=29 THEN QTDE ELSE 0 END) AS EN29,        
 SUM(CASE WHEN TAMANHO=30 THEN QTDE ELSE 0 END) AS EN30,        
 SUM(CASE WHEN TAMANHO=31 THEN QTDE ELSE 0 END) AS EN31,        
 SUM(CASE WHEN TAMANHO=32 THEN QTDE ELSE 0 END) AS EN32,        
 SUM(CASE WHEN TAMANHO=33 THEN QTDE ELSE 0 END) AS EN33,        
 SUM(CASE WHEN TAMANHO=34 THEN QTDE ELSE 0 END) AS EN34,        
 SUM(CASE WHEN TAMANHO=35 THEN QTDE ELSE 0 END) AS EN35,        
 SUM(CASE WHEN TAMANHO=36 THEN QTDE ELSE 0 END) AS EN36,        
 SUM(CASE WHEN TAMANHO=37 THEN QTDE ELSE 0 END) AS EN37,        
 SUM(CASE WHEN TAMANHO=38 THEN QTDE ELSE 0 END) AS EN38,        
 SUM(CASE WHEN TAMANHO=39 THEN QTDE ELSE 0 END) AS EN39,        
 SUM(CASE WHEN TAMANHO=40 THEN QTDE ELSE 0 END) AS EN40,        
 SUM(CASE WHEN TAMANHO=41 THEN QTDE ELSE 0 END) AS EN41,        
 SUM(CASE WHEN TAMANHO=42 THEN QTDE ELSE 0 END) AS EN42,        
 SUM(CASE WHEN TAMANHO=43 THEN QTDE ELSE 0 END) AS EN43,        
 SUM(CASE WHEN TAMANHO=44 THEN QTDE ELSE 0 END) AS EN44,        
 SUM(CASE WHEN TAMANHO=45 THEN QTDE ELSE 0 END) AS EN45,        
 SUM(CASE WHEN TAMANHO=46 THEN QTDE ELSE 0 END) AS EN46,        
 SUM(CASE WHEN TAMANHO=47 THEN QTDE ELSE 0 END) AS EN47,        
 SUM(CASE WHEN TAMANHO=48 THEN QTDE ELSE 0 END) AS EN48     
FROM HR_NFE_REFERENCIA    
GROUP BY CHAVE_NFE,FILIAL,NF_NUMERO,SERIE_NF,PRODUTO,COR_PRODUTO,FORNECEDOR,EMISSAO,ARQUIVO   ' 
